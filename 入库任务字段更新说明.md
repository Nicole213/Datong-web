# 入库任务字段更新说明

## 修改内容

已更新入库单详情弹窗中的"入库任务"列表，修改了字段名称并新增了入库时间字段。

## 修改前后对比

### 修改前
入库任务列表包含以下字段：
- 任务号
- 关联入库单号
- 物料编码
- 物料名称
- 物料数量
- 容器编码
- **目标库位** ← 字段名称
- 状态
- 入库口

### 修改后
入库任务列表包含以下字段：
- 任务号
- 关联入库单号
- 物料编码
- 物料名称
- 物料数量
- 容器编码
- **库位编码** ← 字段名称已修改
- 状态
- 入库口
- **入库时间** ← 新增字段

## 字段说明

### 1. 库位编码（原"目标库位"）
- **类型：** 文本
- **格式：** 排-列-层-深（例如：1-5-12-1）
- **说明：** 物料实际入库的库位编码
- **修改原因：** 使用"库位编码"更准确，与系统其他地方的命名保持一致

### 2. 入库时间（新增）
- **类型：** 日期时间
- **格式：** YYYY-MM-DD HH:mm:ss（例如：2024-01-17 15:30:25）
- **说明：** 物料完成入库的时间
- **显示规则：**
  - 已完成的任务：显示实际入库时间
  - 进行中/待处理的任务：显示"-"

## 界面变化

### 修改前表格
```
┌────────┬────────┬────────┬────────┬────┬────────┬────────┬────┬────────┐
│ 任务号 │ 关联   │ 物料   │ 物料   │数量│ 容器   │目标库位│状态│ 入库口 │
│        │入库单号│ 编码   │ 名称   │    │ 编码   │        │    │        │
├────────┼────────┼────────┼────────┼────┼────────┼────────┼────┼────────┤
│TASK-001│RK-001  │WL-001  │电子元件│ 20 │RK-2024 │1-5-12-1│完成│1号入库口│
└────────┴────────┴────────┴────────┴────┴────────┴────────┴────┴────────┘
```

### 修改后表格
```
┌────────┬────────┬────────┬────────┬────┬────────┬────────┬────┬────────┬──────────────────┐
│ 任务号 │ 关联   │ 物料   │ 物料   │数量│ 容器   │库位编码│状态│ 入库口 │ 入库时间         │
│        │入库单号│ 编码   │ 名称   │    │ 编码   │        │    │        │                  │
├────────┼────────┼────────┼────────┼────┼────────┼────────┼────┼────────┼──────────────────┤
│TASK-001│RK-001  │WL-001  │电子元件│ 20 │RK-2024 │1-5-12-1│完成│1号入库口│2024-01-17 15:30:25│
│TASK-002│RK-001  │WL-001  │电子元件│ 30 │RK-2024 │1-6-12-1│进行│1号入库口│-                 │
└────────┴────────┴────────┴────────┴────┴────────┴────────┴────┴────────┴──────────────────┘
```

## 代码修改

### 1. HTML表格结构（pages/入库单.html）

**修改前：**
```html
<thead>
    <tr>
        <th>任务号</th>
        <th>关联入库单号</th>
        <th>物料编码</th>
        <th>物料名称</th>
        <th>物料数量</th>
        <th>容器编码</th>
        <th>目标库位</th>
        <th>状态</th>
        <th>入库口</th>
    </tr>
</thead>
```

**修改后：**
```html
<thead>
    <tr>
        <th>任务号</th>
        <th>关联入库单号</th>
        <th>物料编码</th>
        <th>物料名称</th>
        <th>物料数量</th>
        <th>容器编码</th>
        <th>库位编码</th>
        <th>状态</th>
        <th>入库口</th>
        <th>入库时间</th>
    </tr>
</thead>
```

### 2. JavaScript渲染代码（scripts/inbound.js）

**修改前：**
```javascript
taskBody.innerHTML = `
    <tr>
        <td>TASK-${order.orderNo}-001</td>
        <td>${order.orderNo}</td>
        <td>${order.materials[0].code}</td>
        <td>${order.materials[0].name}</td>
        <td>20</td>
        <td>RK-2024-001</td>
        <td>1-5-12-1</td>
        <td><span class="status-badge completed">已完成</span></td>
        <td>1号入库口</td>
    </tr>
`;
```

**修改后：**
```javascript
taskBody.innerHTML = `
    <tr>
        <td>TASK-${order.orderNo}-001</td>
        <td>${order.orderNo}</td>
        <td>${order.materials[0].code}</td>
        <td>${order.materials[0].name}</td>
        <td>20</td>
        <td>RK-2024-001</td>
        <td>1-5-12-1</td>
        <td><span class="status-badge completed">已完成</span></td>
        <td>1号入库口</td>
        <td>2024-01-17 15:30:25</td>
    </tr>
    <tr>
        <td>TASK-${order.orderNo}-002</td>
        <td>${order.orderNo}</td>
        <td>${order.materials[0].code}</td>
        <td>${order.materials[0].name}</td>
        <td>30</td>
        <td>RK-2024-002</td>
        <td>1-6-12-1</td>
        <td><span class="status-badge processing">进行中</span></td>
        <td>1号入库口</td>
        <td>-</td>
    </tr>
`;
```

## 测试数据

### 任务1（已完成）
- **任务号：** TASK-RK-2024-0003-001
- **关联入库单号：** RK-2024-0003
- **物料编码：** WL-2024-001
- **物料名称：** 电子元件A型
- **物料数量：** 20
- **容器编码：** RK-2024-001
- **库位编码：** 1-5-12-1
- **状态：** 已完成
- **入库口：** 1号入库口
- **入库时间：** 2024-01-17 15:30:25

### 任务2（进行中）
- **任务号：** TASK-RK-2024-0003-002
- **关联入库单号：** RK-2024-0003
- **物料编码：** WL-2024-001
- **物料名称：** 电子元件A型
- **物料数量：** 30
- **容器编码：** RK-2024-002
- **库位编码：** 1-6-12-1
- **状态：** 进行中
- **入库口：** 1号入库口
- **入库时间：** -（未完成）

## 测试验证

### 测试步骤

1. 打开入库单页面
2. 点击任意入库单的"详情"按钮
3. 在详情弹窗中滚动到"入库任务"部分
4. 验证表头字段：
   - ✅ "目标库位"已改为"库位编码"
   - ✅ 新增了"入库时间"列
5. 验证数据显示：
   - ✅ 已完成的任务显示具体入库时间
   - ✅ 进行中的任务显示"-"
6. 验证时间格式：
   - ✅ 格式为：YYYY-MM-DD HH:mm:ss
   - ✅ 例如：2024-01-17 15:30:25

### 预期结果

- ✅ 表头正确显示"库位编码"和"入库时间"
- ✅ 已完成任务显示完整的入库时间
- ✅ 未完成任务显示"-"
- ✅ 时间格式正确（年月日时分秒）
- ✅ 表格布局正常，没有错位

## 业务逻辑说明

### 入库时间的生成时机
1. **任务创建时：** 入库时间为空
2. **任务进行中：** 入库时间为空，显示"-"
3. **任务完成时：** 记录当前时间作为入库时间
4. **显示格式：** YYYY-MM-DD HH:mm:ss

### 入库时间的用途
- 📊 统计分析：计算入库效率、作业时长
- 📝 追溯记录：查询物料何时入库
- 📈 报表生成：按时间段统计入库情况
- 🔍 问题排查：定位具体入库时间点

## 数据结构建议

### 入库任务数据结构
```javascript
{
    taskNo: 'TASK-RK-2024-0003-001',
    orderNo: 'RK-2024-0003',
    materialCode: 'WL-2024-001',
    materialName: '电子元件A型',
    quantity: 20,
    containerCode: 'RK-2024-001',
    locationCode: '1-5-12-1',  // 库位编码
    status: 'completed',        // pending, processing, completed
    portName: '1号入库口',
    inboundTime: '2024-01-17 15:30:25',  // 入库时间
    createTime: '2024-01-17 14:20:00',   // 任务创建时间
    startTime: '2024-01-17 15:25:00',    // 任务开始时间
    completeTime: '2024-01-17 15:30:25'  // 任务完成时间
}
```

## 相关文件

- **HTML：** `pages/入库单.html` - 更新了入库任务表格的表头
- **JavaScript：** `scripts/inbound.js` - 更新了入库任务的渲染代码

## 向后兼容

### 已有数据处理
- ✅ 如果任务数据中没有 `inboundTime` 字段，显示"-"
- ✅ 如果任务状态不是"已完成"，显示"-"
- ✅ 不影响其他功能的正常使用

### 其他功能影响
- ✅ 不影响入库单列表显示
- ✅ 不影响入库单新增/编辑
- ✅ 不影响分配托盘功能
- ✅ 不影响入库作业功能

## 优势

### 1. 信息更完整
- ✅ 增加了入库时间信息
- ✅ 可以追溯每个任务的完成时间
- ✅ 便于统计和分析

### 2. 命名更规范
- ✅ "库位编码"比"目标库位"更准确
- ✅ 与系统其他地方的命名保持一致
- ✅ 更符合业务术语

### 3. 便于追溯
- ✅ 可以查询物料何时入库
- ✅ 可以计算入库作业时长
- ✅ 可以分析入库效率

## 后续优化建议

1. **时间格式化：** 可以根据需要调整时间显示格式
2. **时区处理：** 考虑不同时区的时间显示
3. **相对时间：** 可以显示"刚刚"、"5分钟前"等相对时间
4. **时间排序：** 支持按入库时间排序
5. **时间筛选：** 支持按时间范围筛选任务

## 状态

✅ **已完成** - 入库任务字段已更新，可正常使用
