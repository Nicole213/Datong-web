<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>出库作业</title>
    <link rel="stylesheet" href="../styles/pages.css">
    <link rel="stylesheet" href="../styles/outbound-operation.css">
</head>
<body>
    <div class="page-container">
        <div class="page-header">
            <h1>出库作业</h1>
            <div class="port-badge" id="portBadge">出库口 1</div>
        </div>

        <!-- 扫描容器区域 -->
        <div class="scan-container-section" id="scanContainerSection">
            <div class="section-header">
                <h2>扫描容器</h2>
            </div>
            
            <!-- 出库单信息 -->
            <div class="info-card">
                <div class="card-title">出库单信息</div>
                <div class="order-list" id="orderListPreview">
                    <!-- 出库单列表将通过JavaScript动态生成 -->
                </div>
            </div>

            <div class="info-card">
                <div class="card-title">扫描容器编码</div>
                <div class="scan-container-area">
                    <div class="scan-input-group">
                        <label>容器编码：</label>
                        <input type="text" class="scan-input" id="scanContainerCode" placeholder="请扫描容器编码" autocomplete="off">
                    </div>
                    <button class="scan-container-btn" id="scanContainerBtn">扫描容器</button>
                </div>
                <div class="help-text">请使用PDA扫描到达出库口的容器编码</div>
            </div>
        </div>

        <!-- 当前出库信息（扫码后显示） -->
        <div class="current-outbound-section" id="currentOutboundSection" style="display: none;">
            <div class="section-header">
                <h2>当前出库信息</h2>
            </div>
            
            <!-- 出库单信息 -->
            <div class="info-card">
                <div class="card-title">出库单信息</div>
                <div class="order-list" id="orderList">
                    <!-- 出库单列表将通过JavaScript动态生成 -->
                </div>
            </div>

            <!-- 容器信息 -->
            <div class="info-card">
                <div class="card-title-with-action">
                    <div class="card-title">当前容器信息</div>
                    <button class="scan-new-container-btn" id="scanNewContainerBtn">扫描容器</button>
                </div>
                <div class="info-item" style="margin-bottom: 12px;">
                    <label>容器编码：</label>
                    <span id="currentContainerCode" class="highlight-text">-</span>
                </div>
                <div class="info-item" style="margin-bottom: 16px;">
                    <label>容器类型：</label>
                    <span id="currentContainerType">-</span>
                </div>
                <div class="scan-area">
                    <div class="scan-input-group">
                        <label>扫描物料编码：</label>
                        <input type="text" class="scan-input" id="scanMaterialCode" placeholder="请扫描物料编码" autocomplete="off">
                    </div>
                    <button class="scan-material-btn" id="scanMaterialBtn">扫描物料码</button>
                </div>
            </div>

            <!-- 容器物料明细 -->
            <div class="info-card">
                <div class="card-title">容器物料明细</div>
                <table class="mini-table">
                    <thead>
                        <tr>
                            <th width="100">物料编码</th>
                            <th width="120">物料名称</th>
                            <th width="60">图片</th>
                            <th width="70">当前数量</th>
                            <th width="100">关联出库单</th>
                            <th width="80">需出库数量</th>
                            <th width="80">实际出库数量</th>
                            <th width="80">状态</th>
                        </tr>
                    </thead>
                    <tbody id="materialTableBody">
                        <!-- 物料明细将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>

            <!-- 操作按钮 -->
            <div class="info-card">
                <div class="action-buttons">
                    <button class="primary-btn" id="confirmAllOutboundBtn">确认全部出库</button>
                    <button class="secondary-btn" id="cancelAllBtn">取消</button>
                </div>
            </div>

            <!-- 回库库位选择 -->
            <div class="info-card" id="returnLocationCard" style="display: none;">
                <div class="card-title">容器回库</div>
                <div class="success-info-inline">
                    <div class="success-icon-small">✓</div>
                    <div class="success-text-small">所有物料已出库完成！</div>
                </div>
                <div class="location-select-area">
                    <div class="form-group">
                        <label class="required">选择回库库位：</label>
                        <select class="form-input" id="returnLocationSelect">
                            <option value="">请选择回库库位</option>
                        </select>
                        <div class="help-text">系统已自动推荐适配该容器的空库位</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="primary-btn" id="confirmReturnBtn">确认入库</button>
                    <button class="secondary-btn" id="cancelReturnBtn">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 确认出库弹窗 -->
    <div class="modal" id="confirmOutboundModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>确认出库</h3>
                <span class="modal-close" id="confirmModalClose">&times;</span>
            </div>
            <div class="modal-body">
                <div class="success-info">
                    <div class="success-icon">✓</div>
                    <div class="success-text">请确认出库信息</div>
                </div>
                <div class="container-info">
                    <div class="info-item">
                        <label>出库单号：</label>
                        <span id="modalOrderNo">-</span>
                    </div>
                    <div class="info-item">
                        <label>物料编码：</label>
                        <span id="modalMaterialCode">-</span>
                    </div>
                    <div class="info-item">
                        <label>物料名称：</label>
                        <span id="modalMaterialName">-</span>
                    </div>
                    <div class="info-item">
                        <label>需出库数量：</label>
                        <span id="modalRequiredQty">-</span>
                    </div>
                    <div class="info-item">
                        <label>实际出库数量：</label>
                        <span id="modalActualQty" class="highlight-text">-</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" id="confirmOutboundBtn">确认出库</button>
                <button class="modal-btn secondary" id="cancelOutboundBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 确认入库库位弹窗 -->
    <div class="modal" id="confirmLocationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择入库库位</h3>
                <span class="modal-close" id="locationModalClose">&times;</span>
            </div>
            <div class="modal-body">
                <div class="success-info">
                    <div class="success-icon">✓</div>
                    <div class="success-text">出库完成！</div>
                </div>
                <div class="container-info">
                    <div class="info-item">
                        <label>容器编码：</label>
                        <span id="modalContainerCode">-</span>
                    </div>
                    <div class="info-item">
                        <label>容器类型：</label>
                        <span id="modalContainerType">-</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="required">选择入库库位：</label>
                    <select class="form-input" id="modalLocationSelect">
                        <option value="">请选择库位</option>
                    </select>
                    <div class="help-text">系统已自动推荐适配该容器的空库位</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" id="confirmLocationBtn">确认入库</button>
                <button class="modal-btn secondary" id="cancelLocationBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 未确认物料提示弹窗 -->
    <div class="modal" id="unconfirmedModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>出库未完成</h3>
                <span class="modal-close" id="unconfirmedModalClose">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warning-info">
                    <div class="warning-icon">!</div>
                    <div class="warning-text">以下物料尚未确认出库</div>
                </div>
                <div class="unconfirmed-list" id="unconfirmedList">
                    <!-- 未确认物料列表将通过JavaScript动态生成 -->
                </div>
                <div class="help-text" style="margin-top: 16px; text-align: center;">
                    请先逐个确认出库后再点击"确认全部出库"按钮
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn primary" id="closeUnconfirmedBtn">知道了</button>
            </div>
        </div>
    </div>

    <script src="../scripts/outbound-operation.js"></script>
</body>
</html>
