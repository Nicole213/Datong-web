# 出库作业功能说明

## 功能概述

出库作业是WMS系统中的核心功能，用于处理托盘容器到达出库口后的物料出库操作。该功能支持复杂的多订单、多物料出库场景，并在出库完成后自动生成容器回库任务。

## 功能特性

### 1. 出库口标识
- 固定显示当前操作终端所属出库口（如"出库口 1"）
- 不可手动修改，由系统配置决定
- 采用醒目的渐变色徽章显示

### 2. 出库单信息展示
- 支持同时显示多个出库单
- 每个出库单显示：
  - 出库单号
  - 计划数量（总计）
  - 已出数量（实时更新）
  - 待出数量（实时计算）
- 卡片式布局，状态一目了然

### 3. 容器信息管理

#### 3.1 扫描容器
- PDA扫码输入容器编码
- 支持回车键快速提交
- 验证容器是否存在
- 验证容器是否已到达出库口

#### 3.2 容器基本信息
- 容器编码
- 容器类型（如标准托盘、周转箱等）

### 4. 物料明细管理

#### 4.1 物料信息展示
容器中的每个物料显示以下信息：
- 物料编码
- 物料名称
- 物料图片（图标）
- 当前数量（库存）
- 关联的出库单号
- 需出库数量（按订单维度）
- 实际出库数量（可编辑）

#### 4.2 复杂场景支持
**场景1：一个物料关联多个订单**
```
物料 A：
- 订单1：需出库 50
- 订单2：需出库 30
```
系统会在表格中分行显示，每行对应一个订单的出库需求。

**场景2：部分物料无需出库**
```
容器中存储：
- 物料 A：需要出库
- 物料 B：需要出库
- 物料 C：不需要出库
```
系统会标记物料C为"无需出库"，采用灰色背景区分。

#### 4.3 扫描物料定位
- PDA扫码物料编码
- 系统自动高亮显示该物料的所有出库明细行
- 方便在物料较多时快速定位
- 验证物料是否在容器中
- 验证物料是否需要出库

### 5. 出库操作流程

#### 5.1 填写实际出库数量
- 在"实际出库数量"列的输入框中填写
- 支持键盘输入和扫码枪输入
- 实时验证数量合法性

#### 5.2 数量验证规则
- 不能小于0
- 不能超过需出库数量
- 不能超过当前库存数量
- 验证失败时给出明确提示

#### 5.3 确认出库
- 按订单维度逐个确认
- 点击"确认出库"按钮
- 弹窗显示确认信息：
  - 出库单号
  - 物料编码
  - 物料名称
  - 需出库数量
  - 实际出库数量
- 二次确认后完成出库
- 已确认的行显示绿色背景和"已确认"状态
- 已确认的行不可再次编辑

#### 5.4 数据更新
确认出库后，系统自动更新：
- 容器物料的当前数量（减少）
- 出库单的已出数量（增加）
- 出库单的待出数量（减少）
- 出库单状态（全部完成时标记为"已完成"）

### 6. 容器回库

#### 6.1 触发条件
- 容器中所有需要出库的物料都已确认出库
- 系统自动显示回库区域

#### 6.2 库位选择
- 系统推荐适配该容器的空库位
- 下拉框显示可选库位列表
- 格式：库位编码 (库区名称)
- 支持手动修改选择

#### 6.3 确认回库
- 点击"确认回库"按钮
- 系统生成该容器的入库任务
- 任务信息包括：
  - 容器编码
  - 目标库位
  - 任务类型：回库
- 堆垛机将自动执行回库任务

### 7. 界面设计特性

#### 7.1 颜色标识
- 出库口徽章：粉紫渐变色
- 出库单卡片：蓝紫渐变色
- 需出库物料行：浅黄色背景
- 无需出库物料行：浅灰色背景
- 扫码高亮行：浅蓝色背景
- 已确认行：浅绿色背景

#### 7.2 交互优化
- 所有扫描框支持回车键提交
- 扫描容器后自动聚焦到物料扫描框
- 扫描物料后自动高亮对应行
- 确认出库后自动更新界面状态
- 所有出库完成后自动显示回库区域

#### 7.3 响应式设计
- 支持PC端和平板端操作
- 移动端优化布局
- 适配不同屏幕尺寸

## 操作流程图

```
开始
  ↓
扫描容器编码
  ↓
显示容器信息和物料明细
  ↓
[可选] 扫描物料编码定位
  ↓
填写实际出库数量
  ↓
点击"确认出库"按钮
  ↓
弹窗确认信息
  ↓
确认出库
  ↓
更新数据和界面
  ↓
是否所有物料都已出库？
  ├─ 否 → 返回"填写实际出库数量"
  └─ 是 → 显示回库区域
       ↓
     选择回库库位
       ↓
     确认回库
       ↓
     生成入库任务
       ↓
     结束
```

## 典型使用场景

### 场景1：标准出库流程
1. 托盘到达出库口1
2. 操作员扫描容器编码：TP-001
3. 系统显示容器中的3种物料
4. 操作员扫描物料A的编码
5. 系统高亮显示物料A的2个订单明细
6. 操作员填写订单1的实际出库数量：50
7. 点击订单1的"确认出库"按钮
8. 弹窗确认后完成订单1的出库
9. 操作员填写订单2的实际出库数量：30
10. 点击订单2的"确认出库"按钮
11. 完成物料A的所有出库
12. 重复步骤4-11，完成物料B和物料C的出库
13. 系统自动显示回库区域
14. 操作员选择推荐的库位
15. 点击"确认回库"按钮
16. 系统生成回库任务，完成整个流程

### 场景2：快速出库（不扫描物料）
1. 扫描容器编码
2. 直接在表格中填写各订单的实际出库数量
3. 逐行点击"确认出库"按钮
4. 完成所有出库后选择回库库位
5. 确认回库

### 场景3：部分出库
1. 扫描容器编码
2. 容器中有5种物料，但只有3种需要出库
3. 系统自动标识哪些物料需要出库
4. 操作员只需处理需要出库的物料
5. 完成后容器回库，剩余物料继续存储

## 数据结构

### 出库单数据
```javascript
{
    orderNo: 'CK-2024-001',      // 出库单号
    plannedQty: 100,              // 计划数量
    outboundQty: 0,               // 已出数量
    pendingQty: 100,              // 待出数量
    materials: [                  // 物料列表
        {
            code: 'WL-2024-001',
            name: '电子元件A型',
            requiredQty: 50
        }
    ]
}
```

### 容器数据
```javascript
{
    code: 'TP-001',              // 容器编码
    type: '标准托盘',            // 容器类型
    materials: [                 // 物料列表
        {
            code: 'WL-2024-001',
            name: '电子元件A型',
            image: '📦',
            currentQty: 100,     // 当前数量
            outboundDetails: [   // 出库明细
                {
                    orderNo: 'CK-2024-001',
                    requiredQty: 50,
                    actualQty: 0
                }
            ]
        }
    ]
}
```

## 技术实现

### 文件结构
- `pages/出库作业.html` - 页面结构
- `scripts/outbound-operation.js` - 业务逻辑
- `styles/outbound-operation.css` - 样式定义

### 核心函数
- `scanContainer()` - 扫描容器
- `scanMaterial()` - 扫描物料
- `renderMaterialTable()` - 渲染物料表格
- `updateActualQty()` - 更新实际出库数量
- `openConfirmModal()` - 打开确认弹窗
- `confirmOutbound()` - 确认出库
- `checkAllOutboundCompleted()` - 检查是否全部完成
- `confirmReturn()` - 确认回库

## 后续优化建议

1. **与后端API集成**
   - 实时获取出库单数据
   - 实时获取容器信息
   - 实时更新出库进度
   - 生成真实的入库任务

2. **打印功能**
   - 打印出库单
   - 打印回库任务单

3. **异常处理**
   - 物料短缺处理
   - 物料损坏处理
   - 容器异常处理

4. **统计报表**
   - 出库效率统计
   - 操作员绩效统计
   - 异常情况统计

5. **移动端优化**
   - 专门的PDA界面
   - 语音提示
   - 震动反馈
