# 入库单物料字段简化说明

## 修改内容

已简化入库单页面中"新增/编辑入库单"弹窗的物料明细字段，去掉了"适配容器类型"和"单个容器最大存放数量"字段。

## 修改前后对比

### 修改前
物料明细包含以下字段：
- ✅ 物料编码（必填）
- ✅ 物料名称（必填）
- ❌ 适配容器类型（必填）- **已删除**
- ✅ 计划入库数量（必填）
- ❌ 单个容器最大存放数量（必填）- **已删除**

### 修改后
物料明细只包含以下字段：
- ✅ 物料编码（必填）
- ✅ 物料名称（必填）
- ✅ 计划入库数量（必填）

## 界面变化

### 修改前布局
```
┌─────────────────────────────────────────────────────────┐
│ 物料 1                                          [删除]  │
├─────────────────────────────────────────────────────────┤
│ 物料编码：[搜索框]    物料名称：[搜索框]              │
│                                                         │
│ 适配容器类型：[下拉框]  计划入库数量：[输入框]        │
│ 单个容器最大存放数量：[输入框]                         │
└─────────────────────────────────────────────────────────┘
```

### 修改后布局
```
┌─────────────────────────────────────────────────────────┐
│ 物料 1                                          [删除]  │
├─────────────────────────────────────────────────────────┤
│ 物料编码：[搜索框]  物料名称：[搜索框]  计划入库数量：[输入框] │
└─────────────────────────────────────────────────────────┘
```

## 代码修改

### 1. 物料项HTML模板（addMaterialItem函数）

**修改前：**
```javascript
<div class="form-row">
    <div class="form-group">
        <label class="required">适配容器类型：</label>
        <select class="form-input material-container" required>
            <option value="">请选择</option>
            <option value="小金属框">小金属框</option>
            <option value="大金属框">大金属框</option>
            <option value="塑料托盘">塑料托盘</option>
            <option value="长物料钢托盘">长物料钢托盘</option>
        </select>
    </div>
    <div class="form-group">
        <label class="required">计划入库数量：</label>
        <input type="number" class="form-input material-qty" min="1" required>
    </div>
    <div class="form-group">
        <label class="required">单个容器最大存放数量：</label>
        <input type="number" class="form-input material-max-qty" min="1" required>
    </div>
</div>
```

**修改后：**
```javascript
<div class="form-row">
    <div class="form-group">
        <label class="required">物料编码：</label>
        ...
    </div>
    <div class="form-group">
        <label class="required">物料名称：</label>
        ...
    </div>
    <div class="form-group">
        <label class="required">计划入库数量：</label>
        <input type="number" class="form-input material-qty" min="1" required>
    </div>
</div>
```

### 2. 自动完成功能（initMaterialAutocomplete函数）

**修改前：**
```javascript
const containerSelect = materialItem.querySelector('.material-container');
const maxQtyInput = materialItem.querySelector('.material-max-qty');

// 自动填充容器类型和最大数量
if (material) {
    if (material.containerTypes.length === 1) {
        containerSelect.value = material.containerTypes[0];
    }
    maxQtyInput.value = material.maxQtyPerContainer;
}
```

**修改后：**
```javascript
// 不再需要获取和填充容器类型和最大数量字段
codeSearch.value = code;
codeValue.value = code;
nameSearch.value = name;
nameValue.value = name;
```

### 3. 保存入库单（saveOrder函数）

**修改前：**
```javascript
const code = item.querySelector('.material-code-value').value.trim();
const name = item.querySelector('.material-name-value').value.trim();
const containerType = item.querySelector('.material-container').value;
const qty = parseInt(item.querySelector('.material-qty').value);
const maxQty = parseInt(item.querySelector('.material-max-qty').value);

if (!code || !name || !containerType || !qty || !maxQty) {
    alert('请填写所有物料明细的必填项！');
    return;
}

materials.push({
    code,
    name,
    containerType,
    plannedQty: qty,
    maxQtyPerContainer: maxQty,
    inboundQty: 0
});
```

**修改后：**
```javascript
const code = item.querySelector('.material-code-value').value.trim();
const name = item.querySelector('.material-name-value').value.trim();
const qty = parseInt(item.querySelector('.material-qty').value);

if (!code || !name || !qty) {
    alert('请填写所有物料明细的必填项！');
    return;
}

materials.push({
    code,
    name,
    plannedQty: qty,
    inboundQty: 0
});
```

### 4. 编辑入库单（editOrder函数）

**修改前：**
```javascript
lastItem.querySelector('.material-code-search').value = material.code;
lastItem.querySelector('.material-code-value').value = material.code;
lastItem.querySelector('.material-name-search').value = material.name;
lastItem.querySelector('.material-name-value').value = material.name;
lastItem.querySelector('.material-container').value = material.containerType || '';
lastItem.querySelector('.material-qty').value = material.plannedQty;
lastItem.querySelector('.material-max-qty').value = material.maxQtyPerContainer || 10;
```

**修改后：**
```javascript
lastItem.querySelector('.material-code-search').value = material.code;
lastItem.querySelector('.material-code-value').value = material.code;
lastItem.querySelector('.material-name-search').value = material.name;
lastItem.querySelector('.material-name-value').value = material.name;
lastItem.querySelector('.material-qty').value = material.plannedQty;
```

## 优势

### 1. 简化操作流程
- ✅ 减少了2个必填字段
- ✅ 降低了用户的输入负担
- ✅ 提高了录入效率

### 2. 更清晰的界面
- ✅ 物料信息更紧凑
- ✅ 一行显示所有字段
- ✅ 视觉上更简洁

### 3. 更灵活的管理
- ✅ 容器类型和数量可以在分配托盘时决定
- ✅ 不需要在创建入库单时就确定容器信息
- ✅ 适应更灵活的仓储策略

## 数据结构变化

### 修改前
```javascript
{
    code: 'WL-2024-001',
    name: '电子元件A型',
    containerType: '小金属框',
    plannedQty: 100,
    maxQtyPerContainer: 50,
    inboundQty: 0
}
```

### 修改后
```javascript
{
    code: 'WL-2024-001',
    name: '电子元件A型',
    plannedQty: 100,
    inboundQty: 0
}
```

## 测试验证

### 测试场景1：新增入库单

1. 打开入库单页面
2. 点击"新增入库单"按钮
3. 填写基础信息
4. 点击"添加物料"按钮
5. 查看物料明细表单
6. 验证只有3个字段：物料编码、物料名称、计划入库数量
7. 填写物料信息
8. 点击"保存"按钮
9. 验证入库单创建成功

**预期结果：**
- ✅ 物料明细只显示3个字段
- ✅ 不再显示"适配容器类型"和"单个容器最大存放数量"
- ✅ 保存成功

### 测试场景2：编辑入库单

1. 打开入库单页面
2. 点击某个入库单的"编辑"按钮
3. 查看物料明细
4. 验证只显示3个字段
5. 修改计划入库数量
6. 点击"保存"按钮
7. 验证更新成功

**预期结果：**
- ✅ 编辑时物料明细只显示3个字段
- ✅ 原有数据正确加载
- ✅ 更新成功

### 测试场景3：添加多个物料

1. 新增入库单
2. 点击"添加物料"按钮3次
3. 查看是否有3个物料项
4. 每个物料项都只有3个字段
5. 填写所有物料信息
6. 保存

**预期结果：**
- ✅ 可以添加多个物料
- ✅ 每个物料项布局一致
- ✅ 所有物料都只有3个字段

## 向后兼容

### 已有数据处理
- ✅ 已有入库单数据中的 `containerType` 和 `maxQtyPerContainer` 字段会被保留
- ✅ 编辑时不会显示这两个字段，但不会删除原有数据
- ✅ 新创建的入库单不会包含这两个字段

### 其他功能影响
- ✅ 不影响入库单列表显示
- ✅ 不影响入库单详情显示
- ✅ 不影响分配托盘功能
- ✅ 不影响入库作业功能

## 相关文件

- **JavaScript：** `scripts/inbound.js` - 修改了以下函数：
  - `addMaterialItem()` - 物料项HTML模板
  - `initMaterialAutocomplete()` - 自动完成功能
  - `saveOrder()` - 保存入库单
  - `editOrder()` - 编辑入库单

## 状态

✅ **已完成** - 物料字段简化已实现，可正常使用
