# 策略物料搜索功能说明

## 功能概述

为入库策略和出库策略的"物料名称"输入框添加了模糊搜索下拉功能，确保只能选择系统中存在的物料。

## 实现时间

2024年1月

## 涉及文件

### 入库策略
- `pages/入库策略.html` - 添加自动完成下拉框结构
- `scripts/inbound-strategy.js` - 添加物料搜索和选择逻辑
- `styles/inbound-strategy.css` - 添加下拉框样式

### 出库策略
- `pages/出库策略.html` - 添加自动完成下拉框结构
- `scripts/outbound-strategy.js` - 添加物料搜索和选择逻辑
- 复用 `styles/inbound-strategy.css` 样式

## 功能特性

### 1. 模糊搜索
- 支持按物料编码、物料名称、物料分类进行模糊搜索
- 实时显示匹配结果
- 输入任意关键字即可触发搜索

### 2. 下拉显示
搜索结果以下拉列表形式展示，每个物料项包含：
- **物料编码**（蓝色显示，便于识别）
- **物料名称**（主要信息）
- **规格和分类**（灰色小字，辅助信息）

### 3. 交互体验
- 点击下拉列表中的物料即可选中
- 选中后自动填充物料名称和编码
- 点击页面其他地方自动关闭下拉框
- 鼠标悬停高亮显示

### 4. 数据验证
- 保存策略时验证物料必须从下拉列表中选择
- 不能随意输入不存在的物料
- 如果输入无效物料，提示"请从下拉列表中选择有效的物料！"

## 物料数据

系统预置了8个测试物料：

| 物料编码 | 物料名称 | 规格 | 分类 |
|---------|---------|------|------|
| MAT-001 | 电子元件A型 | 10×5×3cm | 电子元件 |
| MAT-002 | 机械零件B型 | 20×10×5cm | 机械零件 |
| MAT-003 | 塑料配件C型 | 15×8×4cm | 塑料配件 |
| MAT-004 | 长物料钢材D型 | 200×10×5cm | 钢材 |
| MAT-005 | 金属材料E型 | 30×20×10cm | 金属材料 |
| MAT-006 | 电子元件F型 | 8×4×2cm | 电子元件 |
| MAT-007 | 机械零件G型 | 25×15×8cm | 机械零件 |
| MAT-008 | 塑料配件H型 | 12×6×3cm | 塑料配件 |

## 使用流程

### 新增策略时选择物料

1. 点击"新增"按钮打开策略弹窗
2. 选择管理维度为"物料"
3. 物料名称输入框自动启用
4. 在输入框中输入关键字（如"电子"、"MAT-001"等）
5. 下拉列表显示匹配的物料
6. 点击选择所需物料
7. 物料名称和编码自动填充
8. 添加规则并保存

### 编辑策略时修改物料

1. 点击策略的"编辑"按钮
2. 如果是物料维度的策略，物料名称输入框显示当前物料
3. 可以清空输入框重新搜索选择其他物料
4. 保存时验证物料有效性

## 技术实现

### HTML结构
```html
<div class="autocomplete-wrapper">
    <input type="text" class="form-input" id="materialName" 
           placeholder="请输入物料名称进行搜索" 
           disabled autocomplete="off">
    <input type="hidden" id="materialCode">
    <div class="autocomplete-dropdown" id="materialDropdown"></div>
</div>
```

### JavaScript核心函数

1. **onMaterialInput(e)** - 处理输入事件，执行模糊搜索
2. **onMaterialFocus(e)** - 处理焦点事件，显示已有搜索结果
3. **selectMaterial(code)** - 选择物料，填充数据
4. **onDimensionChange()** - 管理维度变化时控制字段状态

### CSS样式

- `.autocomplete-wrapper` - 包装容器，相对定位
- `.autocomplete-dropdown` - 下拉框，绝对定位
- `.autocomplete-item` - 物料项，悬停高亮
- `.autocomplete-item-code` - 物料编码，蓝色显示
- `.autocomplete-item-name` - 物料名称，主要信息
- `.autocomplete-item-spec` - 规格分类，灰色小字

## 验证规则

### 保存时验证
```javascript
if (dimension === '物料') {
    if (!materialName) {
        alert('请输入物料名称！');
        return;
    }
    if (!selectedMaterial) {
        alert('请从下拉列表中选择有效的物料！');
        return;
    }
}
```

### 数据保存
- 新增策略时，使用 `selectedMaterial.code` 和 `selectedMaterial.name`
- 编辑策略时，同样使用选中的物料对象
- 确保物料编码和名称的一致性

## 注意事项

1. **必须选择有效物料** - 不能随意输入，必须从下拉列表中选择
2. **物料数据来源** - 实际应用中应从物料管理模块获取数据
3. **搜索性能** - 当前为前端搜索，物料数量较多时建议改为后端接口
4. **编码唯一性** - 物料编码作为唯一标识，确保不重复

## 后续优化建议

1. **接口集成** - 将物料数据改为从后端API获取
2. **分页加载** - 物料数量多时支持分页或虚拟滚动
3. **缓存机制** - 缓存已加载的物料数据，减少请求
4. **快捷键支持** - 支持上下键选择、回车确认
5. **最近使用** - 记录最近使用的物料，优先显示

## 测试建议

1. 测试模糊搜索功能（编码、名称、分类）
2. 测试选择物料后的数据填充
3. 测试保存时的验证逻辑
4. 测试编辑已有策略时的物料显示
5. 测试切换管理维度时的字段状态
6. 测试下拉框的打开和关闭
7. 测试输入无效物料时的提示
