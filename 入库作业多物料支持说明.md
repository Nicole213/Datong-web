# 入库作业多物料支持说明

## 更新内容

已更新入库作业页面，支持一个容器推荐和实际存储多种物料。

## 主要改进

### 1. 推荐存储物料 - 支持多物料

**修改前：**
- 只显示单个推荐物料和数量
- 格式：推荐存储物料 / 推荐存储数量

**修改后：**
- 使用表格显示多个推荐物料
- 每个物料显示：物料编码、物料名称、推荐数量

**示例数据：**
```
容器编码：RK-2024-001
推荐存储物料：
┌──────────────┬────────────────┬──────────┐
│ 物料编码     │ 物料名称       │ 推荐数量 │
├──────────────┼────────────────┼──────────┤
│ WL-2024-001  │ 电子元件A型    │ 20       │
│ WL-2024-003  │ 塑料配件C型    │ 15       │
└──────────────┴────────────────┴──────────┘
```

### 2. 实际存储信息 - 支持多物料扫描

**修改前：**
- 只能扫描一种物料
- 扫描后直接显示物料信息

**修改后：**
- 可以扫描多种物料
- 每扫描一种物料后点击"添加物料"按钮
- 使用表格显示所有已扫描的物料
- 支持修改每种物料的数量
- 支持删除已添加的物料

**操作流程：**
```
1. 扫描第一种物料编码
   ↓
2. 输入数量
   ↓
3. 点击"添加物料"按钮
   ↓
4. 物料添加到列表中
   ↓
5. 继续扫描第二种物料
   ↓
6. 输入数量
   ↓
7. 点击"添加物料"按钮
   ↓
8. 第二种物料添加到列表中
   ↓
9. 可以继续添加更多物料
   ↓
10. 点击"确认组盘"完成
```

**已扫描物料列表：**
```
┌──────────────┬────────────────┬──────────┬────────┐
│ 物料编码     │ 物料名称       │ 实际数量 │ 操作   │
├──────────────┼────────────────┼──────────┼────────┤
│ WL-2024-001  │ 电子元件A型    │ [20]     │ [删除] │
│ WL-2024-003  │ 塑料配件C型    │ [15]     │ [删除] │
│ WL-2024-005  │ 金属材料E型    │ [10]     │ [删除] │
└──────────────┴────────────────┴──────────┴────────┘
```

### 3. 待组盘列表 - 显示多物料推荐

**修改前：**
- 推荐存储物料列显示单个物料
- 推荐存储数量列显示单个数量

**修改后：**
- 推荐存储物料列显示所有推荐物料（格式：物料编码(数量)）
- 推荐存储数量列显示总数量

**示例：**
```
┌──────────────┬──────────────────┬────────────────────────┬──────────┐
│ 容器编码     │ 当前存储物料明细 │ 推荐存储物料           │ 推荐数量 │
├──────────────┼──────────────────┼────────────────────────┼──────────┤
│ RK-2024-001  │ 电子元件A型×30   │ WL-2024-001(20)、      │ 35       │
│              │                  │ WL-2024-003(15)        │          │
└──────────────┴──────────────────┴────────────────────────┴──────────┘
```

## 功能特点

### 1. 灵活的物料添加
- ✅ 支持扫描多种物料
- ✅ 每种物料可以单独设置数量
- ✅ 支持回车键快速添加
- ✅ 自动聚焦到扫描框，提高效率

### 2. 实时数据验证
- ✅ 验证物料是否属于当前入库单
- ✅ 验证数量不超过待入库数量
- ✅ 重复扫描同一物料会累加数量

### 3. 便捷的数据编辑
- ✅ 可以直接修改列表中的数量
- ✅ 可以删除已添加的物料
- ✅ 修改时实时验证数量

### 4. 清晰的信息展示
- ✅ 推荐物料和实际物料都用表格展示
- ✅ 信息层次清晰，易于查看
- ✅ 支持多行显示，不会拥挤

## 测试数据

### 容器1：RK-2024-001
**推荐存储物料：**
- WL-2024-001 - 电子元件A型 × 20
- WL-2024-003 - 塑料配件C型 × 15

### 容器2：RK-2024-002
**推荐存储物料：**
- WL-2024-003 - 塑料配件C型 × 50

### 容器3：RK-2024-003
**推荐存储物料：**
- WL-2024-005 - 金属材料E型 × 25
- WL-2024-001 - 电子元件A型 × 10
- WL-2024-003 - 塑料配件C型 × 5

## 测试场景

### 场景1：添加多种物料

1. 打开入库作业页面
2. 查看当前容器（RK-2024-001）
3. 查看推荐存储物料表格（2种物料）
4. 扫描第一种物料：`WL-2024-001`
5. 输入数量：`20`
6. 点击"添加物料"按钮
7. 查看物料是否添加到列表中
8. 扫描第二种物料：`WL-2024-003`
9. 输入数量：`15`
10. 点击"添加物料"按钮
11. 查看是否有2种物料在列表中
12. 点击"确认组盘"
13. 查看弹窗中是否显示2种物料信息

**预期结果：**
- ✅ 两种物料都成功添加
- ✅ 列表显示2行数据
- ✅ 确认组盘弹窗显示完整的物料信息

### 场景2：修改物料数量

1. 添加物料：`WL-2024-001 × 20`
2. 在列表中修改数量为 `25`
3. 失去焦点或按回车
4. 查看数量是否更新

**预期结果：**
- ✅ 数量成功更新为25
- ✅ 数据验证通过

### 场景3：删除物料

1. 添加两种物料
2. 点击第一种物料的"删除"按钮
3. 确认删除
4. 查看列表是否只剩一种物料

**预期结果：**
- ✅ 第一种物料被删除
- ✅ 列表只显示剩余的物料

### 场景4：重复扫描同一物料

1. 扫描物料：`WL-2024-001`
2. 输入数量：`10`
3. 点击"添加物料"
4. 再次扫描：`WL-2024-001`
5. 输入数量：`10`
6. 点击"添加物料"
7. 查看列表中该物料的数量

**预期结果：**
- ✅ 列表中只有一行该物料
- ✅ 数量为20（10+10）

### 场景5：快捷键操作

1. 扫描物料编码后直接按回车
2. 查看是否自动添加物料
3. 输入数量后按回车
4. 查看是否自动添加物料

**预期结果：**
- ✅ 支持回车键快速添加
- ✅ 添加后自动聚焦到扫描框

## 界面改进

### 1. 表格布局
- 使用表格展示推荐物料和实际物料
- 表头清晰，数据对齐
- 支持鼠标悬停高亮

### 2. 操作按钮
- "添加物料"按钮使用绿色，表示添加操作
- "删除"按钮使用红色背景，表示删除操作
- 按钮大小适中，易于点击

### 3. 输入框优化
- 数量输入框在表格中，可直接编辑
- 输入框聚焦时有蓝色边框提示
- 支持键盘操作，提高效率

### 4. 空状态提示
- 没有推荐物料时显示"暂无推荐物料"
- 没有实际物料时显示"暂无数据，请扫描物料"
- 提示文字居中显示，灰色字体

## 代码改进

### 1. 数据结构
```javascript
// 推荐物料 - 数组形式
recommendMaterials: [
    { code: 'WL-2024-001', name: '电子元件A型', qty: 20 },
    { code: 'WL-2024-003', name: '塑料配件C型', qty: 15 }
]

// 实际物料 - 数组形式
actualMaterials = [
    { code: 'WL-2024-001', name: '电子元件A型', qty: 20, materialRef: {...} },
    { code: 'WL-2024-003', name: '塑料配件C型', qty: 15, materialRef: {...} }
]
```

### 2. 核心函数
- `renderRecommendMaterials()` - 渲染推荐物料表格
- `renderActualMaterials()` - 渲染实际物料表格
- `addMaterial()` - 添加物料到列表
- `updateMaterialQty(index, qty)` - 更新物料数量
- `removeMaterial(index)` - 删除物料

### 3. 事件处理
- 支持回车键添加物料
- 支持直接编辑表格中的数量
- 支持删除按钮点击事件

## 相关文件

- **HTML：** `pages/入库作业.html` - 更新了容器信息和实际存储信息的结构
- **CSS：** `styles/inbound-operation.css` - 添加了表格样式和按钮样式
- **JavaScript：** `scripts/inbound-operation.js` - 更新了数据结构和处理逻辑

## 向后兼容

✅ 完全兼容原有功能
- 单物料场景仍然可以正常使用
- 只是增加了多物料支持
- 不影响其他功能

## 状态

✅ **已完成** - 多物料支持已实现并可正常使用
