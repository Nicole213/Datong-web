# 盘点作业功能说明

## 功能概述

盘点作业是PDA操作界面，用于现场盘点容器内的物料。操作人员在盘点口使用PDA扫描容器和物料，填写实际盘点数量，系统自动计算差异并生成盘点入库任务。

## 页面布局

### 1. 页面头部
- **盘点口标识**：固定显示当前操作终端所属盘点口（如"盘点口 1"），不可手动修改
- **页面标题**：显示"盘点作业"

### 2. 扫描容器区域（初始状态）
- **盘点计划信息**：
  - 计划号
  - 盘点范围
  - 负责人
- **扫描容器编码**：
  - 输入框：输入或扫描容器编码
  - 扫描按钮：触发容器扫描
  - 提示文字：引导用户使用PDA扫描

### 3. 当前盘点信息区域（扫码后显示）
- **盘点计划信息**：显示当前执行的盘点计划
- **当前容器信息**：
  - 容器编码（高亮显示）
  - 容器类型
  - 所在库位
  - 扫码容器按钮：重新扫描容器
- **扫描物料定位**：
  - 输入框：扫描物料编码
  - 扫描按钮：定位物料
- **容器物料明细表格**：
  - 物料编码
  - 物料名称
  - 图片
  - 是否盘点（标签显示）
  - 账面数量
  - 盘点数量（可编辑）
  - 盘点差异（自动计算）
  - 盘点结果（自动判断）
- **添加物料按钮**：添加新发现的物料
- **操作按钮**：
  - 完成盘点：确认盘点并选择入库库位
  - 取消：取消当前盘点操作

## 功能详解

### 1. 扫描容器
- 用户在输入框中输入或扫描容器编码
- 支持回车键快速扫描
- 系统验证容器是否存在且已到达盘点口
- 验证通过后显示容器信息和物料明细

### 2. 物料盘点

#### 需要盘点的物料
- **账面数量**：显示系统记录的数量
- **盘点数量**：
  - 默认为0
  - 扫描物料时自动带出账面数量
  - 可手动修改
- **盘点差异**：自动计算（盘点数量 - 账面数量）
  - 正数显示为绿色（盘盈）
  - 负数显示为红色（盘亏）
  - 零显示为正常
- **盘点结果**：自动判断
  - 盘盈：盘点数量 > 账面数量
  - 盘亏：盘点数量 < 账面数量
  - 正常：盘点数量 = 账面数量

#### 不需要盘点的物料
- 所有盘点相关字段显示为"-"
- 不可编辑

### 3. 扫描物料定位
- 用户扫描物料编码
- 系统验证物料是否在当前容器中
- 验证物料是否需要盘点
- 自动填充盘点数量为账面数量
- 高亮显示该物料行（2秒后消失）

### 4. 添加物料
- 点击"添加物料"按钮
- 输入或扫描新物料编码
- 系统检查物料是否已存在
- 添加新物料行：
  - 账面数量：0（不可修改）
  - 盘点数量：需要填写
  - 自动计算差异和结果

### 5. 物料丢失处理
- 如果发现容器中少了物料
- 不需要扫码丢失的物料
- 该物料的盘点数量保持为0
- 系统自动计算为盘亏

### 6. 完成盘点
- 点击"完成盘点"按钮
- 系统检查是否所有需要盘点的物料都已填写
- 如有未填写的物料，提示确认
- 显示入库库位选择弹窗：
  - 系统推荐原库位
  - 可修改为其他适配该容器的空库位
- 确认后生成盘点入库任务
- 显示任务信息和盘点结果
- 返回扫描容器状态

### 7. 重新扫描容器
- 点击"扫码容器"按钮
- 确认是否放弃当前盘点进度
- 返回扫描容器状态

## 交互流程

```
1. 进入页面 → 显示盘点口和计划信息
2. 扫描容器 → 显示容器信息和物料明细
3. 扫描物料 → 自动填充盘点数量
4. 手动调整 → 修改盘点数量
5. 添加物料 → 添加新发现的物料
6. 完成盘点 → 选择入库库位
7. 确认入库 → 生成入库任务
8. 返回初始 → 继续下一个容器
```

## 样式特点

- 参考出库作业页面的设计风格
- 使用蓝紫色渐变主题（#667eea）
- 卡片式布局，清晰分区
- 表格展示物料明细
- 需要盘点的物料行背景为浅黄色
- 不需要盘点的物料行背景为浅灰色
- 扫描定位时高亮显示物料行

## 数据验证

1. **容器编码验证**：
   - 不能为空
   - 必须存在于系统中
   - 必须已到达盘点口

2. **物料编码验证**：
   - 不能为空
   - 必须在当前容器中
   - 必须需要盘点

3. **盘点数量验证**：
   - 不能小于0
   - 必须为整数

4. **添加物料验证**：
   - 物料编码不能为空
   - 物料不能已存在

5. **入库库位验证**：
   - 必须选择库位
   - 库位必须适配该容器

## 技术实现

### HTML结构
- 使用语义化标签
- 卡片式布局
- 表格展示物料明细
- 模态弹窗选择库位

### CSS样式
- 参考出库作业样式
- 响应式设计
- 渐变色主题
- 过渡动画效果

### JavaScript逻辑
- 事件驱动交互
- 数据验证
- 自动计算差异和结果
- 动态渲染表格
- 模态弹窗控制

## 测试场景

### 场景1：正常盘点
1. 扫描容器TP-001
2. 扫描物料WL-2024-001，自动填充数量100
3. 扫描物料WL-2024-002，自动填充数量50
4. 完成盘点，选择库位1-5-12-1
5. 确认入库，生成任务

### 场景2：盘盈
1. 扫描容器TP-001
2. 物料WL-2024-001账面100，填写盘点数量120
3. 系统显示差异+20，结果"盘盈"
4. 完成盘点并确认入库

### 场景3：盘亏
1. 扫描容器TP-001
2. 物料WL-2024-001账面100，填写盘点数量80
3. 系统显示差异-20，结果"盘亏"
4. 完成盘点并确认入库

### 场景4：添加物料
1. 扫描容器TP-001
2. 点击"添加物料"
3. 输入新物料编码WL-2024-999
4. 账面数量显示0，填写盘点数量10
5. 系统显示差异+10，结果"盘盈"
6. 完成盘点并确认入库

### 场景5：物料丢失
1. 扫描容器TP-001
2. 物料WL-2024-001账面100，不填写盘点数量（保持0）
3. 系统显示差异-100，结果"盘亏"
4. 完成盘点并确认入库

## 注意事项

1. 盘点口标识固定显示，不可修改
2. 扫描物料时自动填充账面数量，可手动修改
3. 不需要盘点的物料所有字段显示为"-"，不可编辑
4. 添加物料时账面数量固定为0
5. 完成盘点前会检查是否所有物料都已填写
6. 系统推荐原库位作为入库库位
7. 重新扫描容器会丢失当前盘点进度
