# 入库作业扫码容器功能说明

## 更新时间
2024年

## 功能概述

入库作业页面现在参考出库作业页面的设计，增加了扫码前的初始状态展示。用户需要先扫描容器编码，验证通过后才能显示当前容器的组盘信息。

## 功能特点

### 1. 两阶段界面
- **扫描容器阶段**：显示入库单信息和扫描容器输入框
- **组盘操作阶段**：扫码成功后显示容器信息和组盘操作界面

### 2. 扫描容器区域（初始状态）
- **入库单信息**：
  - 入库单号
  - 计划数量
  - 已入库数量
  - 待入库数量
  
- **扫描容器编码**：
  - 输入框：输入或扫描容器编码
  - 扫描按钮：触发容器验证
  - 提示文字：引导用户使用PDA扫描

### 3. 当前组盘信息区域（扫码后显示）
- **入库单信息**：同扫描区域
- **当前容器信息**：
  - 容器编码（高亮显示）
  - 扫码容器按钮：重新扫描容器
  - 推荐存储物料表格
  
- **实际存储信息**：
  - 扫描物料编码
  - 实际入库数量
  - 添加物料按钮
  - 已扫描物料列表
  
- **操作按钮**：
  - 标记满托复选框
  - 确认组盘
  - 取消组盘

## 交互流程

```
1. 进入页面 → 显示扫描容器区域
2. 扫描容器 → 验证容器编码
3. 验证通过 → 隐藏扫描区域，显示组盘信息区域
4. 扫描物料 → 添加物料到列表
5. 确认组盘 → 选择入库库位
6. 确认入库 → 生成入库任务
7. 返回扫描 → 重新显示扫描容器区域
```

## 数据验证

### 容器编码验证
- 不能为空
- 必须存在于待组盘列表中
- 不能是已完成组盘的容器

### 验证失败提示
- **容器编码为空**：请输入容器编码！
- **容器不存在**：容器编码不存在或未到达入库口！
- **容器已完成**：该容器已完成组盘！

## 界面切换

### 显示扫描区域
- 隐藏组盘信息区域（`currentPalletSection`）
- 显示扫描容器区域（`scanContainerSection`）
- 清空扫描输入框
- 聚焦到容器编码输入框
- 更新预览入库单信息

### 显示组盘区域
- 隐藏扫描容器区域（`scanContainerSection`）
- 显示组盘信息区域（`currentPalletSection`）
- 加载容器信息
- 渲染推荐物料列表
- 清空实际存储信息
- 聚焦到物料扫描框

## 重新扫描容器

### 触发方式
- 点击"扫码容器"按钮

### 确认逻辑
- 如果已添加物料：提示确认是否放弃当前进度
- 如果未添加物料：直接返回扫描状态

### 重置操作
- 重置当前托盘状态为待组盘
- 清空实际物料列表
- 切换到扫描容器区域
- 更新待组盘列表

## 完成组盘后的处理

### 之前的逻辑
- 完成组盘后自动加载下一个待组盘的托盘
- 继续停留在组盘信息区域

### 现在的逻辑
- 完成组盘后返回扫描容器区域
- 用户需要手动扫描下一个容器
- 更符合实际操作流程

## 样式设计

### 扫描容器区域
- 白色背景卡片
- 圆角边框（12px）
- 阴影效果
- 输入框和按钮水平排列

### 扫描按钮
- 蓝紫色背景（#667eea）
- 白色文字
- 悬停时上移2px
- 悬停时增强阴影

### 扫码容器按钮
- 绿色背景（#52c41a）
- 白色文字
- 较小尺寸（8px 20px）
- 显示在容器信息卡片标题右侧

## 技术实现

### 核心函数

#### scanContainer()
- 获取容器编码
- 验证容器是否存在
- 验证容器状态
- 切换到组盘信息区域
- 加载容器信息

#### loadPalletInfo()
- 显示入库单信息
- 显示容器信息
- 渲染推荐物料列表
- 清空实际存储信息
- 更新待组盘列表

#### resetToScanState()
- 重置当前托盘状态
- 清空实际物料列表
- 切换到扫描容器区域
- 清空扫描输入框
- 更新预览信息

#### showPreviewInfo()
- 计算总计划数量
- 计算总已入库数量
- 计算总待入库数量
- 更新预览显示

### 状态管理
```javascript
// 当前操作的托盘
let currentPallet = null;

// 实际扫描的物料列表
let actualMaterials = [];
```

### 界面元素ID
- `scanContainerSection` - 扫描容器区域
- `currentPalletSection` - 组盘信息区域
- `scanContainerCode` - 容器编码输入框
- `scanContainerBtn` - 扫描容器按钮
- `scanNewContainerBtn` - 重新扫描按钮
- `previewOrderNo` - 预览入库单号
- `previewPlannedQty` - 预览计划数量
- `previewInboundQty` - 预览已入库数量
- `previewPendingQty` - 预览待入库数量

## 与出库作业的对比

| 特性 | 出库作业 | 入库作业 |
|------|---------|---------|
| 初始状态 | 显示扫描容器区域 | 显示扫描容器区域 |
| 扫码后 | 显示出库信息区域 | 显示组盘信息区域 |
| 重新扫描 | 扫码容器按钮 | 扫码容器按钮 |
| 完成后 | 返回扫描状态 | 返回扫描状态 |
| 口标识 | 出库口 | 入库口 |
| 主要操作 | 确认出库 | 确认组盘 |

## 测试场景

### 场景1：正常扫描容器
1. 进入入库作业页面
2. 查看入库单信息
3. 输入容器编码：RK-2024-001
4. 点击"扫描容器"按钮
5. 验证通过，显示组盘信息区域
6. 查看容器信息和推荐物料

### 场景2：容器编码不存在
1. 进入入库作业页面
2. 输入不存在的容器编码：RK-9999
3. 点击"扫描容器"按钮
4. 系统提示：容器编码不存在或未到达入库口
5. 输入框清空，停留在扫描状态

### 场景3：容器已完成组盘
1. 进入入库作业页面
2. 输入已完成的容器编码
3. 点击"扫描容器"按钮
4. 系统提示：该容器已完成组盘
5. 输入框清空，停留在扫描状态

### 场景4：重新扫描容器（已添加物料）
1. 扫描容器成功
2. 添加部分物料
3. 点击"扫码容器"按钮
4. 系统提示：确定要重新扫描容器吗？当前容器的组盘进度将不会保存
5. 确认后返回扫描状态

### 场景5：重新扫描容器（未添加物料）
1. 扫描容器成功
2. 未添加任何物料
3. 点击"扫码容器"按钮
4. 直接返回扫描状态，无需确认

### 场景6：完成组盘
1. 扫描容器成功
2. 添加物料
3. 确认组盘
4. 选择入库库位
5. 确认入库
6. 返回扫描容器状态

## 优化建议

### 1. 功能增强
- 支持扫码枪快速输入
- 支持容器编码自动完成
- 支持批量扫描容器
- 支持容器信息预览

### 2. 用户体验
- 添加扫描成功动画
- 添加容器信息卡片
- 添加操作历史记录
- 支持快捷键操作

### 3. 数据验证
- 实时验证容器编码
- 显示验证状态图标
- 提供更详细的错误信息
- 支持多语言提示

## 注意事项

1. 扫描容器是入库作业的第一步，必须先扫描才能进行后续操作
2. 容器编码必须存在于待组盘列表中
3. 已完成组盘的容器不能再次扫描
4. 重新扫描容器会丢失当前组盘进度
5. 完成组盘后会自动返回扫描状态
6. 输入框支持回车键快速操作
7. 扫描成功后自动聚焦到物料扫描框
8. 预览信息会实时更新入库进度

## 总结

入库作业页面现在完全参考出库作业的设计模式，增加了扫码前的初始状态展示。用户需要先扫描容器编码，验证通过后才能进行组盘操作。这样的设计更符合实际操作流程，提升了用户体验和操作安全性。完成组盘后自动返回扫描状态，方便用户继续处理下一个容器。
