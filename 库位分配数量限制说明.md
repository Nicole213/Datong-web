# 库位分配数量限制功能说明

## 功能概述
在出库单的库位分配弹窗中，增加了分配数量的限制和验证功能。

## 实现的功能

### 1. 输入框最大值限制
- 每个库位的分配数量输入框都设置了 `max` 属性
- 最大值 = Math.min(库位可用数量, 物料待出数量)
- 例如：库位可用100件，但物料只需要50件，则最大值为50

### 2. 实时输入验证
- 用户输入时，如果超过最大值，会自动修正为最大值
- 弹出提示："分配数量不能超过 XX（待出数量限制）"
- 如果输入负数，会自动修正为1

### 3. 确认时总量验证
- 点击"确认分配"按钮时，会验证所有选中库位的总分配数量
- 如果总数量超过待出数量，会提示错误并阻止分配
- 提示信息包含当前分配数量和待出数量

### 4. 关闭按钮行为
- 点击库位分配弹窗右上角的关闭按钮（×）
- 只关闭当前的库位分配弹窗
- 如果是从批量分配进入的，会返回到批量分配弹窗
- 如果是从手工分配进入的，会返回到手工分配弹窗

## 代码修改位置

### scripts/outbound.js

1. **renderLocationList() 函数**（约833-905行）
   - 添加了 `pendingQty` 的获取
   - 计算 `maxQty = Math.min(loc.availableQty, pendingQty)`
   - 为输入框添加 `data-max` 和 `max` 属性
   - 添加 `input` 和 `blur` 事件监听器进行实时验证

2. **confirmLocationAllocate() 函数**（约917-975行）
   - 添加了总量验证逻辑
   - 如果总分配数量超过待出数量，会提示错误并返回

3. **closeLocationAllocateModal() 函数**（约1126-1130行）
   - 只移除库位分配弹窗的 'active' 类
   - 不影响其他弹窗的状态

## 测试场景

### 场景1：单个库位数量限制
1. 进入批量分配或手工分配
2. 点击某个物料的"库位分配"按钮
3. 在分配数量输入框中输入超过待出数量的值
4. 预期：自动修正为最大值，并弹出提示

### 场景2：多个库位总量限制
1. 进入库位分配弹窗
2. 选择多个库位
3. 为每个库位填写分配数量，使总和超过待出数量
4. 点击"确认分配"
5. 预期：提示错误，不允许分配

### 场景3：关闭按钮行为
1. 从批量分配进入库位分配弹窗
2. 点击右上角的关闭按钮（×）
3. 预期：只关闭库位分配弹窗，返回批量分配弹窗

## 注意事项
- 待出数量 = 计划数量 - 已分配数量
- 每次打开库位分配弹窗时，都会重新计算最大可分配数量
- 输入验证是实时的，用户体验更好
